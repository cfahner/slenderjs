"function"!=typeof Object.create&&(Object.create=function(){var e=function(){};return function(k){if(1<arguments.length)throw Error("Second argument not supported");if("object"!=typeof k)throw TypeError("Argument must be an object");e.prototype=k;var a=new e;e.prototype=null;return a}}());"object"!==typeof window.console&&(window.console={log:function(e){}});
(function(e,k){var a=e.jQuery,g=e.document;e.Slender={version:"0.1.1"};var f=e.Slender;a(function(){a(".sl-nojs").remove();a(g).on("animationstart MSAnimationStart webkitAnimationStart oAnimationStart",".sl-nojs",function(b){"slNodeInserted"===b.originalEvent.animationName&&a(this).remove()})});var h={};f.subscribe=function(a,d,c){a in h||(h[a]=[]);h[a].push({subber:d,func:c})};f.unsubscribe=function(b,d){b in h&&h[b].length&&(h[b]=a.map(h[b],function(a){return a.func===d?k:a}))};f.publish=function(b,
d,c){var l=[];a.each(h[b]||[],function(e,f){a.isFunction(f.func)&&l.push(f.func.apply(f.subber,[c||{},d,b]))});return l};var t={},p=1,q={};f.View=function(){};f.View.prototype.enhance=function(a,d){this.viewId=a;this.element=d;this.onEnhance()};f.View.prototype.restore=function(){this.onRestore();delete this.viewId;delete this.element};f.defineView=function(a,d){t[a]=d};f.enhanceViews=function(b){a(b).find("[data-view]").each(function(){if(!a(this).data("SlenderViewId")){var b=a(this).attr("data-view"),
c=t[b];if(c){b=p;p+=1;var l=Object.create(f.View.prototype),e;for(e in c)l[e]=c[e];q[b]=l;a(this).data("SlenderViewId",b);l.enhance(b,a(this))}else console.log("undefined view: "+b)}})};f.restoreViews=function(b){a(b).find("[data-view]").each(function(){var b=a(this).data("SlenderViewId");b&&(q[b].restore(),delete q[b],a(this).removeData("SlenderViewId"))})};f.defineView("Slender.TestView",{onEnhance:function(){this.element.text("Enhanced "+this.viewId);console.log("TestView onEnhance");console.log(this)},
onRestore:function(){this.element.text("Restored "+this.viewId);console.log("TestView onRestore");console.log(this)}});a(function(){f.enhanceViews(a("body"))});a(g).on("keyup focus","textarea.sl-input",function(){clearTimeout(a(this).data("shrinkTimeout"));var b=a(this),d=a(e).scrollTop();b.css({height:0,"min-height":0,"max-height":0});var c=b[0].scrollHeight+parseFloat(b.css("border-top-width"))+parseFloat(b.css("border-bottom-width"));0===b[0].clientHeight&&(c+=parseFloat(b.css("padding-top"))+
parseFloat(b.css("padding-bottom")));b.css({height:c+15,"min-height":"","max-height":""});a(e).scrollTop(d)});a(g).on("blur","textarea.sl-input",function(){var b=this;a(this).data("shrinkTimeout",setTimeout(function(){a(b).css({height:"","min-height":"","max-height":""})},500))});var w=a("<button class='sl-flat sl-switch-enh'>").append(a("<span class=sl-switch-flip>"),a("<span class=sl-switch-space>"),a("<span class=sl-switch-text>")),u=function(a,d){var c=a.val(),e=d.data("valueOn"),f=d.data("valueOff"),
g=f,h=d.data("labelOff"),x=d.find(".sl-switch-flip").removeClass("sl-switch-flip-on");c===f&&(g=e,h=d.data("labelOn"),x.addClass("sl-switch-flip-on"));a.val(g);d.find(".sl-switch-text").text(h)},y=function(b){var d=w.clone().addClass(b.attr("class"));b.after(d).hide();var c=b.find(".sl-switch-on");0>=c.length&&(c=a(b.find("option")[0]));0>=c.length&&(c=a("<option value=1>").text("\u00e2\u0153\u201c"));var e=b.find(".sl-switch-off");0>=e.length&&(e=a(b.find("option")[1]));0>=e.length&&(e=a("<option value=0>").text("\u00c3\u2014"));
d.data({valueOn:c.val(),valueOff:e.val(),labelOn:c.text(),labelOff:e.text()}).click(function(){b.is(":enabled")&&u(b,d)});for(c=0;2>c;c+=1)u(b,d)};a(function(){a(g).on("animationstart MSAnimationStart webkitAnimationStart oAnimationStart",".sl-switch",function(b){"slNodeInserted"===b.originalEvent.animationName&&y(a(b.target))})});var z=a("<div class=sl-tmid><div class='sl-ind sl-ind-load'></div></div>"),A=a("<div class=sl-tmid><div class='sl-ind sl-ind-error'></div></div>"),r,B=function(b,d){"object"!==
typeof d&&(d={});n();r=a(e.document.activeElement);var c=a("<div class=sl-popbg>"),g=a("<div class=sl-popwrap>"),h=a("<div class=sl-popcontain>").click(function(a){a.target===this&&n()}),k=a("<div class=sl-pop tabindex=0>"),m=a("<div>").html(z);d.styled&&k.addClass("sl-popstyled");k.append(m);a.ajax(b,{cache:!1,success:function(a){m.html(a);f.enhanceViews(m)},error:function(){m.html(A)}});a("body").append(c);a("body").append(g.html(h.html(k)));setTimeout(function(){k.focus()},0);c.add(g)},n=function(){a("body").find(".sl-popwrap, .sl-popbg").remove();
r&&r.focus()};a(g).on("click",".sl-popopen",function(b){var d=/^([0-9]*(\.[0-9]+)?){1}(em|px)?$/,c=a(this).attr("data-screen-width");if(d.test(c)||"medium"===c||"large"===c)if("medium"===c?c="35em":"large"===c&&(c="65em"),c=d.exec(c),d=parseFloat(c[1]),c=c[3],"em"===c&&a(e).width()/parseFloat(a("body").css("font-size"))<d||"px"===c&&a(e).width()<d)return;b.preventDefault();B(a(this).attr("data-pophref")||a(this).attr("href")||"",{styled:"true"===a(this).attr("data-styled")})});a(g).on("click","a.sl-popclose",
function(b){0<a(this).closest(".sl-pop").length&&(b.preventDefault(),n())});a(g).keydown(function(a){27===a.which&&n()});a(g).on("focus","input, select, textarea",function(){"string"!==typeof a(this).data("sl-last-confirm")&&a(this).data("sl-last-confirm",a(this).val())});a(g).on("change input paste keyup","input, select, textarea",function(){var b=a(this);clearTimeout(b.data("sl-current-timeout"));b.data("sl-current-timeout",setTimeout(function(){b.val()!=b.data("sl-last-confirm")&&(b.data("sl-last-confirm",
b.val()),b.trigger("delaytextchange"))},500))});a.valHooks.text={set:function(b,d){a(b).data("sl-last-confirm",d)}};var v=function(){a(this).closest("form").submit()};a(g).on("change",".sl-autosubmit",v).on("delaytextchange",".sl-autosubmit-delay",v)})(window);
